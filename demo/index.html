<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <title>t-car-search demo</title>
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../t-car-search.html">
    <link rel="import" href="../t-car-search-api.html">
    <link rel="import" href="../../t-mystique-auth/t-mystique-auth.html">
</head>

<body>
    <template is="dom-bind" id="domBindTemplate">
        <t-car-search id="searchView"></t-car-search>
        <t-car-search-api id="searchApi" loading={{loading}} api-base-url="http://qa-mystiquecode.tavisca.com/" api-relative-url="api/Car/search" auth-token="{{tokenResponse.authenticationToken}}"></t-car-search-api>
        <t-car-search-api id="resultApi" loading={{loading}} api-base-url="http://qa-mystiquecode.tavisca.com/" api-relative-url="api/Car/search" auth-token="{{tokenResponse.authenticationToken}}"></t-car-search-api>
        <t-mystique-auth name="mystique" url="http://qa-mystiquecode.tavisca.com/api/authentication/authenticate/context" token-response="{{tokenResponse}}" auto></t-mystique-auth>
        <template is="dom-if" if="{{loading}}">
            <div>API in-progress, wait..</div>
        </template>
    </template>
</body>
<script type="text/javascript">
window.addEventListener('WebComponentsReady', function(e) {
    var template = document.getElementById('domBindTemplate');

    template.$.searchView.addEventListener('t-car-search', template.$.searchApi.onSearch.bind(template.$.searchApi));
    template.$.searchApi.addEventListener('t-car-search-api-success', template.$.searchView.onSearchSuccess.bind(template.$.searchView));
    template.$.searchApi.addEventListener('t-car-search-api-error', template.$.searchView.onSearchError.bind(template.$.searchView));

    template.$.searchApi.addEventListener('t-car-search-api-authenticate-success', function() {
        alert('login success-do post handling');
    });

});
</script>

</html>
